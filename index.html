
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amarilla</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .btn-touch { min-height: 56px; font-size: 16px; }
        .menu-overlay { backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Top Bar -->
    <div class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="flex items-center justify-between px-4 py-3">
            <button onclick="toggleMenu()" class="text-2xl">‚ò∞</button>
            <div class="text-center flex-1">
                <div class="text-xs text-gray-500" id="currentUser">Roberto Sanchez</div>
                <div class="font-semibold text-gray-900" id="currentProject">Select Project</div>
            </div>
            <div class="w-8"></div>
        </div>
    </div>

    <!-- Menu Overlay -->
    <div id="menuOverlay" class="fixed inset-0 bg-black bg-opacity-50 menu-overlay hidden z-40" onclick="closeMenu()"></div>
    
    <!-- Side Menu -->
    <div id="sideMenu" class="fixed left-0 top-0 bottom-0 w-72 bg-white shadow-xl transform -translate-x-full transition-transform duration-300 z-50">
        <div class="p-4 border-b border-gray-200">
            <div class="font-semibold text-lg">Menu</div>
            <div class="text-sm text-gray-600">Roberto Sanchez</div>
        </div>
        <div class="p-2">
            <button onclick="showScreen('selectProject')" class="w-full text-left px-4 py-4 hover:bg-gray-50 rounded-lg flex items-center gap-3 btn-touch">
                <span class="text-xl">üèóÔ∏è</span>
                <span class="font-medium">Change Project</span>
            </button>
            <button onclick="showScreen('dashboard')" class="w-full text-left px-4 py-4 hover:bg-gray-50 rounded-lg flex items-center gap-3 btn-touch">
                <span class="text-xl">üìä</span>
                <span class="font-medium">Dashboard</span>
            </button>
            <button onclick="showScreen('timesheet')" class="w-full text-left px-4 py-4 hover:bg-gray-50 rounded-lg flex items-center gap-3 btn-touch">
                <span class="text-xl">‚è∞</span>
                <span class="font-medium">Log Crew Time</span>
            </button>
            <button onclick="showScreen('tasks')" class="w-full text-left px-4 py-4 hover:bg-gray-50 rounded-lg flex items-center gap-3 btn-touch">
                <span class="text-xl">‚öôÔ∏è</span>
                <span class="font-medium">Manage Tasks</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="pb-20">
        
        <!-- Project Selection Screen -->
        <div id="screenSelectProject">
            <div class="p-4">
                <h2 class="text-xl font-bold mb-4">Select Project</h2>
                <div class="space-y-3">
                    <button onclick="selectProject('Residencia Martinez', 'proj1')" class="w-full bg-white rounded-lg p-4 shadow border-2 border-gray-200 active:border-blue-500 text-left btn-touch">
                        <div class="font-semibold text-lg">Residencia Martinez</div>
                        <div class="text-sm text-gray-600">Started Nov 2024 ‚Ä¢ 6 active tasks</div>
                    </button>
                    <button onclick="selectProject('Villa Santos', 'proj2')" class="w-full bg-white rounded-lg p-4 shadow border-2 border-gray-200 active:border-blue-500 text-left btn-touch">
                        <div class="font-semibold text-lg">Villa Santos</div>
                        <div class="text-sm text-gray-600">Started Jan 2025 ‚Ä¢ 1 active task</div>
                    </button>
                    <button onclick="selectProject('Casa Moderna', 'proj3')" class="w-full bg-white rounded-lg p-4 shadow border-2 border-gray-200 active:border-blue-500 text-left btn-touch">
                        <div class="font-semibold text-lg">Casa Moderna</div>
                        <div class="text-sm text-gray-600">Started Feb 2025 ‚Ä¢ 2 active tasks</div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Dashboard Screen -->
        <div id="screenDashboard" class="hidden">
            <div class="p-4">
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <div class="text-xs text-gray-600 mb-1">Total Budget</div>
                        <div class="text-2xl font-bold text-blue-700" id="dashTotalBudget">0h</div>
                    </div>
                    <div class="bg-orange-50 rounded-lg p-4">
                        <div class="text-xs text-gray-600 mb-1">Hours Used</div>
                        <div class="text-2xl font-bold text-orange-700" id="dashUsedHours">0h</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4">
                        <div class="text-xs text-gray-600 mb-1">Available</div>
                        <div class="text-2xl font-bold text-green-700" id="dashAvailable">0h</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-xs text-gray-600 mb-1">Progress</div>
                        <div class="text-2xl font-bold text-purple-700" id="dashProgress">0%</div>
                    </div>
                </div>
                
                <h3 class="font-semibold mb-3">Active Tasks</h3>
                <div id="dashTasksList" class="space-y-2"></div>
            </div>
        </div>

        <!-- Timesheet Screen -->
        <div id="screenTimesheet" class="hidden">
            <div class="p-4">
                <input type="date" id="selectedDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 btn-touch text-base">
                
                <!-- Step: Select Task -->
                <div id="stepSelectTask">
                    <div id="tasksList"></div>
                </div>

                <!-- Step: Select Detail -->
                <div id="stepSelectDetail" class="hidden">
                    <button onclick="backToTaskSelection()" class="mb-4 text-orange-600 font-medium btn-touch">‚Üê Back</button>
                    <div id="taskContext" class="bg-orange-50 rounded-lg p-4 mb-4 border border-orange-300"></div>
                    <div id="detailsList"></div>
                </div>

                <!-- Step: Assign Workers -->
                <div id="stepAssignWorkers" class="hidden">
                    <button onclick="backToPreviousStep()" class="mb-4 text-orange-600 font-medium btn-touch">‚Üê Back</button>
                    <div id="taskContextFull" class="bg-orange-50 rounded-lg p-4 mb-4 border border-orange-300"></div>
                    
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold">Select Workers</h3>
                        <button onclick="toggleAllWorkers()" class="text-sm text-orange-600 font-medium btn-touch">Select All</button>
                    </div>
                    
                    <div id="workersList" class="space-y-2 mb-4"></div>
                    <div id="selectedSummary" class="bg-orange-100 rounded-lg p-3 mb-4 text-sm hidden"></div>
                    
                    <button onclick="logCrewTime()" class="w-full px-4 py-4 bg-orange-600 text-white rounded-lg font-semibold btn-touch active:bg-orange-700">
                        Log Time
                    </button>
                </div>
            </div>

            <!-- Today's Summary -->
            <div id="todaysSummary" class="hidden bg-white border-t-4 border-gray-200 p-4">
                <h3 class="font-semibold mb-3">Today (<span id="summaryDate"></span>)</h3>
                <div id="entriesList" class="space-y-2 mb-3"></div>
                <div class="pt-3 border-t border-gray-300 flex justify-between font-semibold">
                    <span>Total:</span>
                    <span class="text-orange-600" id="totalHoursToday">0h</span>
                </div>
            </div>
        </div>

        <!-- Tasks Management Screen -->
        <div id="screenTasks" class="hidden">
            <div class="p-4">
                <div class="flex items-center justify-between mb-4">
                    <button onclick="toggleShowClosed()" id="btnShowClosed" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-medium btn-touch">
                        Show Open Only
                    </button>
                </div>
                
                <div id="tasksListManage" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <script>
        let tasks = [
            { id: 't1', groupName: 'Concrete', activityName: 'Foundation Pour', location: 'Foundation Area', budgetHours: 140, usedHours: 140, estimatedCompletion: 1.0, trackByDetail: false, availableDetails: ['Footings', 'Grade Beams', 'Piers'], status: 'closed', projectId: 'proj1' },
            { id: 't2', groupName: 'Drywall', activityName: 'Framing', location: '1st & 2nd Floor', budgetHours: 375, usedHours: 280, estimatedCompletion: 0.75, trackByDetail: true, availableDetails: ['Nichos', 'Ceilings', 'Walls'], status: 'open', projectId: 'proj1' },
            { id: 't3', groupName: 'Drywall', activityName: 'Board Installation', location: '1st & 2nd Floor', budgetHours: 280, usedHours: 120, estimatedCompletion: 0.45, trackByDetail: true, availableDetails: ['Level 5 Finish', 'Standard Finish', 'Moisture Resistant'], status: 'open', projectId: 'proj1' },
            { id: 't4', groupName: 'Drywall', activityName: 'Plaster & Finish', location: '1st & 2nd Floor', budgetHours: 220, usedHours: 0, estimatedCompletion: 0, trackByDetail: false, availableDetails: [], status: 'open', projectId: 'proj1' },
            { id: 't5', groupName: 'MEP', activityName: 'Electrical Rough-In', location: 'All Floors', budgetHours: 160, usedHours: 145, estimatedCompletion: 0.95, trackByDetail: true, availableDetails: ['Conduit', 'Junction Boxes', 'Panel Install'], status: 'open', projectId: 'proj1' },
            { id: 't6', groupName: 'MEP', activityName: 'Plumbing Rough-In', location: 'All Floors', budgetHours: 140, usedHours: 140, estimatedCompletion: 1.0, trackByDetail: false, availableDetails: [], status: 'closed', projectId: 'proj1' },
            { id: 't7', groupName: 'Drywall', activityName: 'Framing', location: 'All Floors', budgetHours: 200, usedHours: 15, estimatedCompletion: 0.08, trackByDetail: true, availableDetails: ['Nichos', 'Ceilings', 'Walls'], status: 'open', projectId: 'proj2' }
        ];

        const workers = [
            { id: 'w1', name: 'Carlos Martinez', trade: 'Carpenter' },
            { id: 'w2', name: 'Jose Rodriguez', trade: 'Carpenter' },
            { id: 'w3', name: 'Miguel Santos', trade: 'Laborer' },
            { id: 'w4', name: 'Juan Hernandez', trade: 'Electrician' },
            { id: 'w5', name: 'Luis Garcia', trade: 'Carpenter' },
            { id: 'w6', name: 'Pedro Ramirez', trade: 'Laborer' }
        ];

        let entries = [];
        let currentProjectId = null;
        let currentProjectName = null;
        let showClosedTasks = false;
        let selectedTask = null;
        let selectedDetail = null;
        let selectedWorkers = [];
        let workerHours = {};

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('selectedDate').valueAsDate = new Date();
            showScreen('selectProject');
        });

        function toggleMenu() {
            const menu = document.getElementById('sideMenu');
            const overlay = document.getElementById('menuOverlay');
            menu.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        function closeMenu() {
            document.getElementById('sideMenu').classList.add('-translate-x-full');
            document.getElementById('menuOverlay').classList.add('hidden');
        }

        function selectProject(name, id) {
            currentProjectName = name;
            currentProjectId = id;
            document.getElementById('currentProject').textContent = name;
            showScreen('timesheet');
            closeMenu();
        }

        function showScreen(screen) {
            if (screen !== 'selectProject' && !currentProjectId) {
                showScreen('selectProject');
                return;
            }

            ['screenSelectProject', 'screenDashboard', 'screenTimesheet', 'screenTasks'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });
            
            document.getElementById('screen' + screen.charAt(0).toUpperCase() + screen.slice(1)).classList.remove('hidden');
            
            if (screen === 'timesheet') {
                showStep('selectTask');
                renderTasksList();
            } else if (screen === 'tasks') {
                renderTasksManage();
            } else if (screen === 'dashboard') {
                renderDashboard();
            }
            
            updateSummary();
            closeMenu();
        }

        function getProjectTasks() {
            return tasks.filter(t => t.projectId === currentProjectId);
        }

        function getTasksWithSaldo() {
            const organized = {};
            const projectTasks = getProjectTasks().filter(t => t.status === 'open');
            
            projectTasks.forEach(task => {
                const usedTotal = task.usedHours + calculateTaskHours(task.id);
                const available = task.budgetHours - usedTotal;
                
                if (available > 0) {
                    if (!organized[task.groupName]) {
                        organized[task.groupName] = { groupName: task.groupName, tasks: [] };
                    }
                    organized[task.groupName].tasks.push({
                        ...task,
                        currentUsed: usedTotal,
                        available: available
                    });
                }
            });
            
            return Object.values(organized);
        }

        function calculateTaskHours(taskId) {
            return entries.filter(e => e.taskId === taskId).reduce((sum, e) => sum + e.hours, 0);
        }

        function renderDashboard() {
            const projectTasks = getProjectTasks();
            const totalBudget = projectTasks.reduce((sum, t) => sum + t.budgetHours, 0);
            const totalUsed = projectTasks.reduce((sum, t) => sum + t.usedHours + calculateTaskHours(t.id), 0);
            const totalAvailable = totalBudget - totalUsed;
            const avgProgress = projectTasks.reduce((sum, t) => sum + t.estimatedCompletion, 0) / projectTasks.length;

            document.getElementById('dashTotalBudget').textContent = totalBudget + 'h';
            document.getElementById('dashUsedHours').textContent = totalUsed.toFixed(0) + 'h';
            document.getElementById('dashAvailable').textContent = totalAvailable.toFixed(0) + 'h';
            document.getElementById('dashProgress').textContent = (avgProgress * 100).toFixed(0) + '%';

            const activeTasks = projectTasks.filter(t => t.status === 'open');
            document.getElementById('dashTasksList').innerHTML = activeTasks.map(task => {
                const used = task.usedHours + calculateTaskHours(task.id);
                const progress = (used / task.budgetHours * 100).toFixed(0);
                return `
                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                        <div class="font-medium text-sm">${task.groupName} ‚Üí ${task.activityName}</div>
                        <div class="text-xs text-gray-600 mt-1">${task.location}</div>
                        <div class="flex items-center gap-2 mt-2">
                            <div class="flex-1 bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${progress}%"></div>
                            </div>
                            <span class="text-xs font-medium">${progress}%</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderTasksList() {
            const groups = getTasksWithSaldo();
            const container = document.getElementById('tasksList');
            
            if (groups.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-600">
                        <p class="mb-4">No open tasks with available hours</p>
                        <button onclick="showScreen('tasks')" class="text-blue-600 underline btn-touch">Manage Tasks</button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = groups.map(group => `
                <div class="mb-4">
                    <div class="text-xs font-semibold text-gray-500 mb-2 px-2">${group.groupName}</div>
                    ${group.tasks.map(task => `
                        <button onclick='selectTask(${JSON.stringify(task).replace(/'/g, "&apos;")})' class="w-full bg-white rounded-lg p-4 shadow border border-gray-200 active:border-orange-500 text-left mb-2 btn-touch">
                            <div class="font-semibold text-base mb-1">${task.activityName}</div>
                            ${task.trackByDetail ? '<div class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded inline-block mb-2">Detail Required</div>' : ''}
                            <div class="text-sm text-gray-600 mb-2">üìç ${task.location}</div>
                            <div class="flex gap-4 text-xs">
                                <div><span class="text-gray-500">Available:</span> <span class="font-semibold text-green-700">${task.available}h</span></div>
                                <div><span class="text-gray-500">Progress:</span> <span class="font-semibold">${(task.estimatedCompletion * 100).toFixed(0)}%</span></div>
                            </div>
                        </button>
                    `).join('')}
                </div>
            `).join('');
        }

        function selectTask(task) {
            selectedTask = task;
            selectedDetail = null;
            selectedWorkers = [];
            workerHours = {};
            
            if (task.trackByDetail) {
                showStep('selectDetail');
                renderDetails();
            } else {
                showStep('assignWorkers');
                renderWorkers();
            }
        }

        function renderDetails() {
            document.getElementById('taskContext').innerHTML = `
                <div class="text-sm font-medium mb-1">${selectedTask.groupName} ‚Üí ${selectedTask.activityName}</div>
                <div class="text-xs text-gray-600">üìç ${selectedTask.location}</div>
            `;
            
            document.getElementById('detailsList').innerHTML = selectedTask.availableDetails.map(detail => `
                <button onclick="selectDetail('${detail}')" class="w-full bg-white rounded-lg p-4 shadow border border-gray-200 active:border-orange-500 text-left mb-2 btn-touch">
                    <span class="font-medium text-base">${detail}</span>
                </button>
            `).join('');
        }

        function selectDetail(detail) {
            selectedDetail = detail;
            showStep('assignWorkers');
            renderWorkers();
        }

        function renderWorkers() {
            document.getElementById('taskContextFull').innerHTML = `
                <div class="text-sm font-medium mb-1">
                    ${selectedTask.groupName} ‚Üí ${selectedTask.activityName}
                    ${selectedDetail ? ` ‚Üí ${selectedDetail}` : ''}
                </div>
                <div class="text-xs text-gray-600">üìç ${selectedTask.location}</div>
            `;
            
            const container = document.getElementById('workersList');
            
            container.innerHTML = workers.map(worker => {
                const hoursToday = getWorkerHoursToday(worker.id);
                const isSelected = selectedWorkers.includes(worker.id);
                const hours = workerHours[worker.id] || 8;
                const totalIfAdded = hoursToday + hours;
                
                return `
                    <div class="rounded-lg p-4 border-2 ${isSelected ? 'bg-orange-50 border-orange-500' : 'bg-white border-gray-200'} btn-touch">
                        <div class="flex items-center gap-3">
                            <button onclick="toggleWorker('${worker.id}')" class="text-2xl flex-shrink-0">
                                ${isSelected ? '‚òëÔ∏è' : '‚¨ú'}
                            </button>
                            <div class="flex-1">
                                <div class="font-medium">${worker.name}</div>
                                <div class="text-sm text-gray-600">${worker.trade}</div>
                                ${hoursToday > 0 ? `
                                    <div class="text-xs text-blue-700 mt-1 font-medium">
                                        Today: ${hoursToday}h${isSelected ? ` ‚Üí ${totalIfAdded}h` : ''}
                                    </div>
                                ` : ''}
                            </div>
                            ${isSelected ? `
                                <input type="number" step="0.5" value="${hours}" onchange="updateWorkerHours('${worker.id}', this.value)" class="w-16 px-2 py-2 border-2 border-orange-300 rounded text-center text-base font-semibold">
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            updateSelectedSummary();
        }

        function toggleWorker(workerId) {
            if (selectedWorkers.includes(workerId)) {
                selectedWorkers = selectedWorkers.filter(id => id !== workerId);
                delete workerHours[workerId];
            } else {
                selectedWorkers.push(workerId);
                workerHours[workerId] = 8;
            }
            renderWorkers();
        }

        function toggleAllWorkers() {
            if (selectedWorkers.length === workers.length) {
                selectedWorkers = [];
                workerHours = {};
            } else {
                selectedWorkers = workers.map(w => w.id);
                workers.forEach(w => workerHours[w.id] = 8);
            }
            renderWorkers();
        }

        function updateWorkerHours(workerId, hours) {
            workerHours[workerId] = parseFloat(hours) || 0;
            updateSelectedSummary();
        }

        function updateSelectedSummary() {
            const summary = document.getElementById('selectedSummary');
            if (selectedWorkers.length > 0) {
                const totalHours = selectedWorkers.reduce((sum, id) => sum + (workerHours[id] || 8), 0);
                summary.innerHTML = `<span class="font-medium">${selectedWorkers.length} workers</span><span class="text-gray-700 ml-2">√ó ${totalHours}h total</span>`;
                summary.classList.remove('hidden');
            } else {
                summary.classList.add('hidden');
            }
        }

        function getWorkerHoursToday(workerId) {
            const selectedDate = document.getElementById('selectedDate').value;
            return entries.filter(e => e.date === selectedDate && e.workerId === workerId).reduce((sum, e) => sum + e.hours, 0);
        }

        function logCrewTime() {
            if (selectedWorkers.length === 0) {
                alert('Please select at least one worker');
                return;
            }
            
            const selectedDate = document.getElementById('selectedDate').value;
            
            selectedWorkers.forEach(workerId => {
                const worker = workers.find(w => w.id === workerId);
                const hours = workerHours[workerId] || 8;
                
                entries.push({
                    id: Date.now() + Math.random(),
                    date: selectedDate,
                    employee: worker.name,
                    workerId: worker.id,
                    hours: hours,
                    location: selectedTask.location,
                    task: selectedTask.activityName,
                    detailName: selectedDetail,
                    groupName: selectedTask.groupName,
                    taskId: selectedTask.id
                });
            });
            
            selectedTask = null;
            selectedDetail = null;
            selectedWorkers = [];
            workerHours = {};
            
            showStep('selectTask');
            renderTasksList();
            updateSummary();
        }

        function showStep(step) {
            document.getElementById('stepSelectTask').classList.toggle('hidden', step !== 'selectTask');
            document.getElementById('stepSelectDetail').classList.toggle('hidden', step !== 'selectDetail');
            document.getElementById('stepAssignWorkers').classList.toggle('hidden', step !== 'assignWorkers');
        }

        function backToTaskSelection() {
            selectedTask = null;
            selectedDetail = null;
            showStep('selectTask');
        }

        function backToPreviousStep() {
            if (selectedTask.trackByDetail && !selectedDetail) {
                backToTaskSelection();
            } else if (selectedTask.trackByDetail) {
                selectedDetail = null;
                showStep('selectDetail');
                renderDetails();
            } else {
                backToTaskSelection();
            }
        }

        function renderTasksManage() {
            const projectTasks = getProjectTasks();
            const filtered = showClosedTasks ? projectTasks : projectTasks.filter(t => t.status === 'open');
            const container = document.getElementById('tasksListManage');
            
            container.innerHTML = filtered.map(task => {
                const used = task.usedHours + calculateTaskHours(task.id);
                const available = task.budgetHours - used;
                return `
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex-1">
                                <div class="font-semibold">${task.groupName} ‚Üí ${task.activityName}</div>
                                <div class="text-sm text-gray-600 mt-1">${task.location}</div>
                            </div>
                            <button onclick="toggleTaskStatus('${task.id}')" class="text-xs px-3 py-1.5 rounded-full font-semibold ${task.status === 'open' ? 'bg-green-100 text-green-700' : 'bg-gray-200 text-gray-600'} btn-touch">
                                ${task.status.toUpperCase()}
                            </button>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-xs mb-2">
                            <div><span class="text-gray-500">Budget:</span> <span class="font-semibold">${task.budgetHours}h</span></div>
                            <div><span class="text-gray-500">Used:</span> <span class="font-semibold text-orange-700">${used}h</span></div>
                            <div><span class="text-gray-500">Available:</span> <span class="font-semibold ${available > 0 ? 'text-green-700' : 'text-red-700'}">${available}h</span></div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="text-xs"><span class="text-gray-500">Progress:</span> <span class="font-semibold">${(task.estimatedCompletion * 100).toFixed(0)}%</span></div>
                            <button onclick="toggleTrackByDetail('${task.id}')" ${task.status === 'closed' ? 'disabled' : ''} class="text-xs px-3 py-1 rounded-full font-medium ${task.trackByDetail ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-600'} btn-touch">
                                Detail ${task.trackByDetail ? 'ON' : 'OFF'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleTaskStatus(taskId) {
            const task = tasks.find(t => t.id === taskId);
            task.status = task.status === 'open' ? 'closed' : 'open';
            renderTasksManage();
        }

        function toggleTrackByDetail(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task.status !== 'closed') {
                task.trackByDetail = !task.trackByDetail;
                renderTasksManage();
            }
        }

        function toggleShowClosed() {
            showClosedTasks = !showClosedTasks;
            document.getElementById('btnShowClosed').textContent = showClosedTasks ? 'Showing All' : 'Show Open Only';
            renderTasksManage();
        }

        function updateSummary() {
            const selectedDate = document.getElementById('selectedDate').value;
            const todayEntries = entries.filter(e => e.date === selectedDate);
            
            if (todayEntries.length === 0) {
                document.getElementById('todaysSummary').classList.add('hidden');
                return;
            }
            
            document.getElementById('todaysSummary').classList.remove('hidden');
            document.getElementById('summaryDate').textContent = selectedDate;
            
            document.getElementById('entriesList').innerHTML = todayEntries.map(entry => `
                <div class="bg-gray-50 rounded p-3 text-sm">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-medium">${entry.employee}</div>
                            <div class="text-xs text-gray-600 mt-1">${entry.groupName} ‚Üí ${entry.task}${entry.detailName ? ` ‚Üí ${entry.detailName}` : ''}</div>
                        </div>
                        <span class="font-semibold text-orange-600 text-base">${entry.hours}h</span>
                    </div>
                </div>
            `).join('');
            
            const totalHours = todayEntries.reduce((sum, e) => sum + e.hours, 0);
            document.getElementById('totalHoursToday').textContent = totalHours + 'h';
        }
    </script>
</body>
</html>